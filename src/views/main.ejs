<div class="container-md" id="mainContainer">
    <% if (user) { %>
        <div>
            <div class="mainHeader">
                <h1>ğŸ’– <%- user.nickname %> ë‹˜ì„ ìœ„í•œ ì¶”ì²œ ê³µê³ </h1>
                <a href="/jobposts?sort=recommended&order=desc">
                    <p>ì¶”ì²œ ê³µê³  ì „ì²´ë³´ê¸° â†’</p>
                </a>
            </div>
            <div id="carouselRecommended" class="carousel carousel-dark slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselRecommended1"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselRecommended2"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselRecommended3"></div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselRecommended"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ì´ì „</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselRecommended"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ë‹¤ìŒ</span>
                </button>
            </div>

        </div>
        <% } %>

            <div class="mainHeader">
                <h1>ğŸ”¥ ê´€ì‹¬ ì£¼ëª©! ì¸ê¸° ê³µê³ </h1>
                <a href="/jobposts?sort=popular&order=desc">
                    <p>ì¸ê¸°ìˆœ ê³µê³  ì „ì²´ë³´ê¸° â†’</p>
                </a>
            </div>
            <div id="carouselPopular" class="carousel carousel-dark slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselPopular1"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselPopular2"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselPopular3"></div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselPopular"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ì´ì „</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselPopular"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ë‹¤ìŒ</span>
                </button>
            </div>

            <div class="mainHeader">
                <h1>âœ¨ ë”°ëœ¬ë”°ëœ¬í•œ ìµœì‹  ê³µê³ </h1>
                <a href="/jobposts?sort=recent&order=desc">
                    <p>ìµœì‹ ìˆœ ê³µê³  ì „ì²´ë³´ê¸° â†’</p>
                </a>
            </div>
            <div id="carouselRecent" class="carousel carousel-dark slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselRecent1"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselRecent2"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselRecent3"></div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselRecent"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ì´ì „</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselRecent"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ë‹¤ìŒ</span>
                </button>
            </div>

            <div class="mainHeader">
                <h1>â° ê³§ ë§ˆê°í•˜ëŠ” ê³µê³ </h1>
            </div>
            <div id="carouselEnding" class="carousel carousel-dark slide">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselEnding1"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselEnding2"></div>
                    </div>
                    <div class="carousel-item">
                        <div class="row row-cols-1 row-cols-md-4 g-4" id="carouselEnding3"></div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselEnding"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ì´ì „</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselEnding"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">ë‹¤ìŒ</span>
                </button>
            </div>
</div>

<script>
    $(document).ready(function () {
        // ë¡œê·¸ì¸ í•œ íšŒì›ì´ ì°œ í•œ ì±„ìš©ê³µê³  ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸
        const likedJobpostIds = getUserLikeJobpost()

        '<% if (user) { %>'
        const userId = '<%= user.userId %>'
        $.ajax({
            type: "GET",
            url: `/api/jobpost/filter/${userId}/?sort=recommended&order=desc&limit=12`,
            success: function (response) {
                console.log(response)
                showCarouselJobposts('carouselRecommended', response.data, likedJobpostIds)
            }
        })
        '<% } %>'

        $.ajax({
            type: 'GET',
            url: '/api/jobpost/filter?sort=recent&order=desc&limit=12',
            success: function (response) {
                console.log('ìµœì‹ ìˆœ : ', response)
                showCarouselJobposts(
                    'carouselRecent',
                    response.data,
                    likedJobpostIds
                )
            },
        })

        $.ajax({
            type: 'GET',
            url: '/api/jobpost/filter?sort=popular&order=desc&limit=12',
            success: function (response) {
                console.log('ì¸ê¸°ìˆœ :', response)
                showCarouselJobposts(
                    'carouselPopular',
                    response.data,
                    likedJobpostIds
                )
            },
        })

        $.ajax({
            type: 'GET',
            url: '/api/jobpost/filter?sort=ending&order=asc&limit=12',
            success: function (response) {
                console.log('ë§ˆê°ìˆœ : ', response)
                showCarouselJobposts(
                    'carouselEnding',
                    response.data,
                    likedJobpostIds
                )
            },
        })
    })

    function showCarouselJobposts(carouselId, response, likedJobpostIds) {
        for (let i = 0; i < 12; i++) {
            // ì±„ìš©ê³µê³  ë²ˆí˜¸
            const jobpostId = response[i].jobpost_id
            // ì±„ìš©ê³µê³ ê°€ ì¢‹ì•„ìš”ê°€ ëˆŒë¦°ê±´ì§€ ì•ˆëˆŒë¦°ê±´ì§€ boolean
            const isLiked = likedJobpostIds.includes(jobpostId) ? true : false
            console.log(isLiked)

            const tempHtml = createJobpostCard(response[i], isLiked)

            const carouselNum = Math.floor(i / 4) + 1
            $(`#${carouselId}${carouselNum}`).append(tempHtml)
        }
    }
</script>